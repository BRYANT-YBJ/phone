<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IELTS Mobile Trainer</title>
    <style>
        :root {
            --bg: #0f172a;
            --surface: #1e293b;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
            --primary: #818cf8;
            --accent: #34d399;
            --error: #f87171;
            --gold: #fbbf24;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100vh; /* è§†å£é«˜åº¦ */
            height: -webkit-fill-available; /* è§£å†³iOS Safariåº•éƒ¨æ é®æŒ¡é—®é¢˜ */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

        /* --- 1. é¡¶éƒ¨æ  (ç´§å‡‘å‹) --- */
        .header {
            padding: 15px;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            z-index: 20;
            border-bottom: 1px solid #334155;
        }

        .streak-badge {
            background: rgba(251, 191, 36, 0.1);
            color: var(--gold);
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .time-display {
            font-family: 'Monaco', monospace;
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        /* è¿›åº¦æ¡ */
        .progress-track { width: 100%; height: 2px; background: #334155; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        /* --- 2. ä¸»èˆå° (ä¸Šç§»ï¼Œé¿å¼€é”®ç›˜) --- */
        .stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* é ä¸Šå¯¹é½ */
            align-items: center;
            padding-top: 10vh; /* è·ç¦»é¡¶éƒ¨ 10% é«˜åº¦ */
            position: relative;
        }

        /* ä¿¡æ¯æç¤ºåŒº */
        .info-panel {
            min-height: 60px;
            text-align: center;
            margin-bottom: 20px;
            opacity: 0; transition: opacity 0.3s;
        }
        .info-panel.visible { opacity: 1; }
        .phonetic { color: var(--primary); font-size: 1.4rem; margin-bottom: 5px; }
        .meaning { color: var(--text-dim); font-size: 1rem; max-width: 80%; margin: 0 auto; line-height: 1.4; }

        /* å•è¯å®¹å™¨ (æ ¸å¿ƒ) */
        .word-box {
            display: flex;
            flex-wrap: wrap; /* å…è®¸æ¢è¡Œï¼Œé˜²æ­¢æ‰‹æœºä¸Šçˆ†å¼€ */
            justify-content: center;
            padding: 20px 10px;
            width: 100%;
            max-width: 100%;
            /* äº¤äº’æ„Ÿåº”åŒº */
            touch-action: manipulation;
        }

        /* å­—æ¯æ ·å¼ (å“åº”å¼å¤§å°) */
        .char {
            font-family: 'Courier New', Courier, monospace;
            font-size: 3rem; /* é»˜è®¤å¤§å­— */
            font-weight: 700;
            width: 0.7em;
            text-align: center;
            border-bottom: 3px solid #475569;
            color: transparent;
            margin: 0 1px 10px 1px; /* å¢åŠ è¡Œè· */
            transition: all 0.1s;
        }

        /* æ‰‹æœºé€‚é…ï¼šå¦‚æœå•è¯å¤ªé•¿ï¼Œè‡ªåŠ¨ç¼©å° */
        @media (max-width: 400px) {
            .char { font-size: 2.2rem; border-bottom-width: 2px; }
        }

        /* çŠ¶æ€ */
        .char.active { border-bottom-color: var(--primary); transform: translateY(-3px); }
        .char.correct { color: var(--accent); border-bottom-color: transparent; }
        .char.wrong { border-bottom-color: var(--error); animation: shake 0.3s; }

        /* --- è§¦å±å·çœ‹æœºåˆ¶ (Touch to Peek) --- */
        /* æ·»åŠ è¿™ä¸ªç±»æ—¶æ˜¾ç¤ºå¹½çµæ–‡å­— */
        .word-box.peeking .char:not(.correct) {
            color: rgba(255, 255, 255, 0.3);
            border-bottom-color: rgba(255, 255, 255, 0.3);
        }

        /* --- 3. åº•éƒ¨æ§åˆ¶ä¸æ•°æ® --- */
        .footer {
            background: var(--surface);
            padding: 15px 10px;
            padding-bottom: max(15px, env(safe-area-inset-bottom)); /* é€‚é… iPhone åº•éƒ¨é»‘æ¡ */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
            z-index: 30;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            text-align: center;
        }

        .stat-val { font-size: 1.1rem; font-weight: bold; color: var(--text-main); display: block; }
        .stat-label { font-size: 0.7rem; color: var(--text-dim); }

        .controls {
            display: flex;
            gap: 10px;
        }

        select, .btn {
            flex: 1;
            padding: 12px;
            background: #334155;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            text-align: center;
        }
        select { -webkit-appearance: none; text-align-last: center; } /* å±…ä¸­ */

        /* é®ç½©å±‚ */
        .overlay {
            position: fixed; inset: 0;
            background: rgba(15, 23, 42, 0.98);
            z-index: 100;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: opacity 0.3s;
        }
        
        .tap-hint {
            margin-top: 20px;
            padding: 10px 25px;
            background: var(--primary);
            color: white;
            border-radius: 50px;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }

        /* éšè—è¾“å…¥æ¡†ï¼Œä½†é˜²æ­¢iOSç¼©æ”¾ */
        #hidden-input {
            position: absolute;
            opacity: 0;
            top: 0; left: 0;
            height: 0; width: 0;
            font-size: 16px; /* é˜²æ­¢ iOS è‡ªåŠ¨ç¼©æ”¾ */
        }

        /* é”®ç›˜å”¤èµ·æç¤ºåŒº */
        .keyboard-trigger {
            position: absolute;
            inset: 0;
            z-index: 5; /* åœ¨ stage ä¹‹ä¸‹ï¼ŒèƒŒæ™¯ä¹‹ä¸Š */
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <div class="header">
        <div class="streak-badge">
            ğŸ”¥ <span id="streak-val">1</span> å¤©
        </div>
        <div class="time-display" id="clock">12:00</div>
    </div>
    
    <div class="progress-track"><div class="progress-fill" id="progress"></div></div>

    <div class="keyboard-trigger" onclick="focusInput()"></div>

    <div class="stage">
        <div class="info-panel" id="info-panel">
            <div class="phonetic" id="phonetic">/ ... /</div>
            <div class="meaning" id="meaning">...</div>
        </div>

        <div class="word-box" id="display" 
             ontouchstart="startPeek()" 
             ontouchend="endPeek()" 
             onmousedown="startPeek()" 
             onmouseup="endPeek()">
        </div>
        
        <div style="margin-top: 20px; color: #475569; font-size: 0.8rem;">
            (é•¿æŒ‰å•è¯å·çœ‹æ‹¼å†™)
        </div>
    </div>

    <div class="footer">
        <div class="stats-grid">
            <div><span class="stat-val" id="count">0</span><span class="stat-label">å®Œæˆ</span></div>
            <div><span class="stat-val" id="wpm">0</span><span class="stat-label">WPM</span></div>
            <div><span class="stat-val" id="accuracy">100%</span><span class="stat-label">æ­£ç¡®ç‡</span></div>
            <div><span class="stat-val" id="deck-left">0</span><span class="stat-label">å‰©ä½™</span></div>
        </div>
        
        <div class="controls">
            <select id="mode-select" onchange="resetGame()">
                <option value="all">âš¡ ç»¼åˆ (800è¯)</option>
                <option value="renting">ğŸ  ç§Ÿæˆ¿ç”Ÿæ´»</option>
                <option value="academic">ğŸ“ å­¦æœ¯åœºæ™¯</option>
                <option value="nature">ğŸŒ¿ è‡ªç„¶ç¯å¢ƒ</option>
            </select>
            <div class="btn" onclick="openKeyboard()">âŒ¨ï¸ é”®ç›˜</div>
        </div>
    </div>

    <div class="overlay" id="start-screen" onclick="startGame()">
        <h1 style="font-size: 2rem; margin:0;">IELTS Mobile</h1>
        <p style="color:#94a3b8">é›…æ€å¬åŠ› Â· ç«–å±ç‰¹è®­</p>
        <div class="tap-hint">ç‚¹å‡»å±å¹•å¼€å§‹</div>
    </div>

    <input type="text" id="hidden-input" autocomplete="off" inputmode="text">

<script>
    // ==========================================
    // ğŸ“‚ ç§»åŠ¨ç«¯é€‚é…è¯åº“
    // ==========================================
    const DATA_RENTING = "accommodation:/É™ËŒkÉ’m.É™ËˆdeÉª.ÊƒÉ™n/:ä½å®¿|deposit:/dÉªËˆpÉ’z.Éªt/:æŠ¼é‡‘|landlord:/ËˆlÃ¦nd.lÉ”Ëd/:æˆ¿ä¸œ|balcony:/ËˆbÃ¦l.kÉ™.ni/:é˜³å°|garage:/ËˆÉ¡Ã¦r.É‘ËÊ’/:è½¦åº“|corridor:/ËˆkÉ’r.Éª.dÉ”Ër/:èµ°å»Š|studio:/ËˆstjuË.di.É™ÊŠ/:å•é—´|suburb:/ËˆsÊŒb.ÉœËb/:éƒŠåŒº|cupboard:/ËˆkÊŒb.É™d/:æ©±æŸœ|refrigerator:/rÉªËˆfrÉªdÊ’.É™r.eÉª.tÉ™r/:å†°ç®±|microwave:/ËˆmaÉª.krÉ™.weÉªv/:å¾®æ³¢ç‚‰|itinerary:/É‘ÉªËˆtÉªn.É™r.É™r.i/:è¡Œç¨‹è¡¨|reservation:/ËŒrez.É™ËˆveÉª.ÊƒÉ™n/:é¢„è®¢|souvenir:/ËŒsuË.vÉ™nËˆÉªÉ™r/:çºªå¿µå“|museum:/mjuËËˆziË.É™m/:åšç‰©é¦†|hostel:/ËˆhÉ’s.tÉ™l/:æ—…ç¤¾|vegetarian:/ËŒvedÊ’.ÉªËˆteÉ™.ri.É™n/:ç´ é£Ÿè€…|pharmacy:/ËˆfÉ‘Ë.mÉ™.si/:è¯æˆ¿|ambulance:/ËˆÃ¦m.bjÉ™.lÉ™ns/:æ•‘æŠ¤è½¦|surgeon:/ËˆsÉœË.dÊ’É™n/:å¤–ç§‘åŒ»ç”Ÿ|prescription:/prÉªËˆskrÉªp.ÊƒÉ™n/:å¤„æ–¹|vaccine:/ËˆvÃ¦k.siËn/:ç–«è‹—|interview:/ËˆÉªn.tÉ™.vjuË/:é¢è¯•|resume:/Ëˆrez.juË.meÉª/:ç®€å†";
    const DATA_ACADEMIC = "curriculum:/kÉ™ËˆrÉªk.jÉ™.lÉ™m/:è¯¾ç¨‹ä½“ç³»|dissertation:/ËŒdÉªs.É™ËˆteÉª.ÊƒÉ™n/:è®ºæ–‡|assignment:/É™ËˆsaÉªn.mÉ™nt/:ä½œä¸š|deadline:/Ëˆded.laÉªn/:æˆªæ­¢|extension:/ÉªkËˆsten.ÊƒÉ™n/:å»¶æœŸ|tutorial:/tjuËËˆtÉ”Ë.ri.É™l/:è¾…å¯¼|seminar:/Ëˆsem.Éª.nÉ‘Ër/:ç ”è®¨ä¼š|psychology:/saÉªËˆkÉ’l.É™.dÊ’i/:å¿ƒç†å­¦|sociology:/ËŒsÉ™ÊŠ.siËˆÉ’l.É™.dÊ’i/:ç¤¾ä¼šå­¦|philosophy:/fÉªËˆlÉ’s.É™.fi/:å“²å­¦|geography:/dÊ’iËˆÉ’É¡.rÉ™.fi/:åœ°ç†|biology:/baÉªËˆÉ’l.É™.dÊ’i/:ç”Ÿç‰©|chemistry:/Ëˆkem.Éª.stri/:åŒ–å­¦|engineering:/ËŒen.dÊ’ÉªËˆnÉªÉ™r.ÉªÅ‹/:å·¥ç¨‹|architecture:/ËˆÉ‘Ë.kÉª.tek.tÊƒÉ™r/:å»ºç­‘|presentation:/ËŒprez.É™nËˆteÉª.ÊƒÉ™n/:å±•ç¤º|assessment:/É™Ëˆses.mÉ™nt/:è¯„ä¼°|certificate:/sÉ™ËˆtÉªf.Éª.kÉ™t/:è¯ä¹¦|professor:/prÉ™Ëˆfes.É™r/:æ•™æˆ|research:/rÉªËˆsÉœËtÊƒ/:ç ”ç©¶|questionnaire:/ËŒkwes.tÊƒÉ™ËˆneÉ™r/:é—®å·|statistics:/stÉ™ËˆtÉªs.tÉªks/:ç»Ÿè®¡|methodology:/ËŒmeÎ¸.É™ËˆdÉ’l.É™.dÊ’i/:æ–¹æ³•è®º|hypothesis:/haÉªËˆpÉ’Î¸.É™.sÉªs/:å‡è®¾|plagiarism:/ËˆpleÉª.dÊ’É™r.Éª.zÉ™m/:æŠ„è¢­";
    const DATA_NATURE = "environment:/ÉªnËˆvaÉª.rÉ™n.mÉ™nt/:ç¯å¢ƒ|pollution:/pÉ™ËˆluË.ÊƒÉ™n/:æ±¡æŸ“|erosion:/ÉªËˆrÉ™ÊŠ.Ê’É™n/:ä¾µèš€|drought:/draÊŠt/:å¹²æ—±|avalanche:/ËˆÃ¦v.É™l.É‘ËnÊƒ/:é›ªå´©|volcano:/vÉ’lËˆkeÉª.nÉ™ÊŠ/:ç«å±±|hurricane:/ËˆhÊŒr.Éª.kÉ™n/:é£“é£|atmosphere:/ËˆÃ¦t.mÉ™.sfÉªÉ™r/:å¤§æ°”å±‚|renewable:/rÉªËˆnjuË.É™.bÉ™l/:å¯å†ç”Ÿçš„|predator:/Ëˆpred.É™.tÉ™r/:æ•é£Ÿè€…|migration:/maÉªËˆÉ¡reÉª.ÊƒÉ™n/:è¿å¾™|extinction:/ÉªkËˆstÉªÅ‹k.ÊƒÉ™n/:ç­ç»|species:/ËˆspiË.ÊƒiËz/:ç‰©ç§|creature:/ËˆkriË.tÊƒÉ™r/:ç”Ÿç‰©|mammal:/ËˆmÃ¦m.É™l/:å“ºä¹³åŠ¨ç‰©|reptile:/Ëˆrep.taÉªl/:çˆ¬è¡ŒåŠ¨ç‰©|amphibian:/Ã¦mËˆfÉªb.i.É™n/:ä¸¤æ –åŠ¨ç‰©|insect:/ËˆÉªn.sekt/:æ˜†è™«|parasite:/ËˆpÃ¦r.É™.saÉªt/:å¯„ç”Ÿè™«|bacteria:/bÃ¦kËˆtÉªÉ™.ri.É™/:ç»†èŒ|virus:/ËˆvaÉª.rÉ™s/:ç—…æ¯’|vegetation:/ËŒvedÊ’.ÉªËˆteÉª.ÊƒÉ™n/:æ¤è¢«|photosynthesis:/ËŒfÉ™ÊŠ.tÉ™ÊŠËˆsÉªn.Î¸É™.sÉªs/:å…‰åˆä½œç”¨|agriculture:/ËˆÃ¦É¡.rÉª.kÊŒl.tÊƒÉ™r/:å†œä¸š|irrigation:/ËŒÉªr.ÉªËˆÉ¡eÉª.ÊƒÉ™n/:çŒæº‰|fertilizer:/ËˆfÉœË.tÉª.laÉª.zÉ™r/:è‚¥æ–™|pesticide:/Ëˆpes.tÉª.saÉªd/:æ€è™«å‰‚|archaeology:/ËŒÉ‘Ë.kiËˆÉ’l.É™.dÊ’i/:è€ƒå¤å­¦|excavation:/ËŒeks.kÉ™ËˆveÉª.ÊƒÉ™n/:æŒ–æ˜|civilization:/ËŒsÉªv.É™l.aÉªËˆzeÉª.ÊƒÉ™n/:æ–‡æ˜";

    // å¼•æ“å˜é‡
    let fullDeck = [], remainingDeck = [];
    let currentWord = {};
    let charIndex = 0;
    
    // ç»Ÿè®¡å˜é‡
    let startTime = null;
    let totalInputs = 0, correctInputs = 0, correctWords = 0, errorCount = 0;
    
    // DOM
    const elInput = document.getElementById('hidden-input');
    const elDisplay = document.getElementById('display');
    const elInfo = document.getElementById('info-panel');
    const elPhonetic = document.getElementById('phonetic');
    const elMeaning = document.getElementById('meaning');
    const elStart = document.getElementById('start-screen');
    
    // Audio Context (ç”¨äºéŸ³æ•ˆ)
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function init() {
        checkStreak();
        setInterval(updateClock, 1000);
        updateClock();
        
        elInput.addEventListener('input', handleInput);
        // å…¼å®¹ Android é”®ç›˜å›è½¦
        elInput.addEventListener('keydown', (e) => {
             if (e.key === 'Enter') {
                 e.preventDefault();
                 playTTS();
             }
        });

        resetGame();
    }

    // --- ğŸ® æ ¸å¿ƒæ¸¸æˆæµç¨‹ ---
    function resetGame() {
        // æ„å»ºè¯åº“
        const mode = document.getElementById('mode-select').value;
        let d1 = [], d2 = [], d3 = [];
        if (mode === 'all' || mode === 'renting') d1 = parseData(DATA_RENTING);
        if (mode === 'all' || mode === 'academic') d2 = parseData(DATA_ACADEMIC);
        if (mode === 'all' || mode === 'nature') d3 = parseData(DATA_NATURE);
        
        fullDeck = [...d1, ...d2, ...d3];
        fullDeck.sort(() => Math.random() - 0.5); // æ´—ç‰Œ
        remainingDeck = [...fullDeck];
        
        // é‡ç½®æ•°æ®
        correctWords = 0; totalInputs = 0; correctInputs = 0; errorCount = 0; startTime = null;
        updateStats();
        
        // åŠ è½½ç¬¬ä¸€ä¸ªè¯
        loadNextWord();
    }

    function loadNextWord() {
        if (remainingDeck.length === 0) {
            alert("ğŸ‰ æ‰€æœ‰å•è¯å·²å®Œæˆï¼é‡æ–°å¼€å§‹å¾ªç¯ã€‚");
            remainingDeck = [...fullDeck].sort(() => Math.random() - 0.5);
        }
        
        currentWord = remainingDeck.pop();
        charIndex = 0;
        
        // UI
        elPhonetic.textContent = currentWord.p;
        elMeaning.textContent = currentWord.m;
        elInfo.classList.add('visible');
        
        elDisplay.innerHTML = '';
        currentWord.w.split('').forEach((char, i) => {
            const span = document.createElement('span');
            span.textContent = char;
            span.className = 'char';
            if (i===0) span.classList.add('active');
            elDisplay.appendChild(span);
        });

        updateStats();
        
        // è‡ªåŠ¨æ’­æ”¾
        setTimeout(playTTS, 300);
    }

    function startGame() {
        elStart.style.opacity = '0';
        setTimeout(() => elStart.style.display = 'none', 300);
        
        if (audioCtx.state === 'suspended') audioCtx.resume();
        focusInput();
        startTime = Date.now();
    }

    // --- âŒ¨ï¸ è¾“å…¥å¤„ç† (é€‚é…æ‰‹æœºè¾“å…¥æ³•) ---
    function handleInput(e) {
        // è·å–è¾“å…¥æ¡†çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼ˆå¤„ç†æ‹¼éŸ³è¾“å…¥æ³•ç¼“å†²ï¼‰
        if (!e.data) return; // å¿½ç•¥éå­—ç¬¦è¾“å…¥
        const inputChar = e.data.slice(-1).toLowerCase();
        
        // æ¸…ç©ºè¾“å…¥æ¡†ï¼Œä¿æŒç©ºçŠ¶æ€
        elInput.value = '';

        processChar(inputChar);
    }
    
    function processChar(key) {
        if (!startTime) startTime = Date.now();
        
        const targetChar = currentWord.w[charIndex].toLowerCase();
        const spans = elDisplay.children;
        
        totalInputs++;

        if (key === targetChar) {
            // æ­£ç¡®
            playClickSound();
            correctInputs++;
            
            // éœ‡åŠ¨ (å®‰å“æœ‰æ•ˆ)
            if (navigator.vibrate) navigator.vibrate(10);
            
            spans[charIndex].classList.remove('active');
            spans[charIndex].classList.add('correct');
            charIndex++;
            
            if (charIndex >= currentWord.w.length) {
                correctWords++;
                setTimeout(loadNextWord, 200);
            } else {
                spans[charIndex].classList.add('active');
            }
        } else {
            // é”™è¯¯
            playErrorSound();
            errorCount++;
            if (navigator.vibrate) navigator.vibrate([30, 30]);
            spans[charIndex].classList.add('wrong');
            setTimeout(() => spans[charIndex].classList.remove('wrong'), 300);
        }
        
        updateStats();
    }

    // --- ğŸ‘† è§¦å±å·çœ‹é€»è¾‘ ---
    function startPeek() { elDisplay.classList.add('peeking'); }
    function endPeek() { elDisplay.classList.remove('peeking'); }

    // --- ğŸ“± è¾…åŠ©åŠŸèƒ½ ---
    function focusInput() {
        elInput.focus();
        elInput.click(); // æŸäº›æµè§ˆå™¨éœ€è¦ click è§¦å‘é”®ç›˜
    }
    
    function openKeyboard() {
        focusInput();
    }

    function updateStats() {
        document.getElementById('deck-left').textContent = remainingDeck.length;
        document.getElementById('count').textContent = correctWords;
        
        const acc = totalInputs === 0 ? 100 : Math.round(((totalInputs - errorCount) / totalInputs) * 100);
        document.getElementById('accuracy').textContent = acc + "%";
        
        const percent = ((fullDeck.length - remainingDeck.length) / fullDeck.length) * 100;
        document.getElementById('progress').style.width = percent + '%';
        
        if (startTime) {
            const mins = (Date.now() - startTime) / 60000;
            if (mins > 0) {
                const wpm = Math.round((correctInputs / 5) / mins);
                document.getElementById('wpm').textContent = wpm;
            }
        }
    }

    // --- ğŸ“… æ‰“å¡ä¸æ—¶é’Ÿ ---
    function updateClock() {
        const now = new Date();
        document.getElementById('clock').textContent = now.toLocaleTimeString('en-GB', {hour:'2-digit', minute:'2-digit'});
    }

    function checkStreak() {
        const today = new Date().toDateString();
        const last = localStorage.getItem('ielts_last_day');
        let streak = parseInt(localStorage.getItem('ielts_streak') || 0);
        
        if (last !== today) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (last === yesterday.toDateString()) {
                streak++; // è¿ç»­æ‰“å¡
            } else {
                streak = 1; // æ–­ç­¾é‡ç½® (æˆ–ç¬¬ä¸€æ¬¡)
            }
            localStorage.setItem('ielts_last_day', today);
            localStorage.setItem('ielts_streak', streak);
        }
        document.getElementById('streak-val').textContent = streak;
    }

    // --- ğŸ”Š éŸ³æ•ˆ ---
    function playTTS() {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(currentWord.w);
        u.lang = 'en-GB'; u.rate = 0.9;
        window.speechSynthesis.speak(u);
    }
    
    function playClickSound() {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.frequency.setValueAtTime(600, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.05);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.05);
    }
    
    function playErrorSound() {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    function parseData(str) {
        return str.split('|').map(s => {
            const [w, p, m] = s.split(':');
            return { w, p, m };
        });
    }

    window.onload = init;
</script>
</body>
</html>